<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Voice Live Avatar</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <div class="app-container">
        <!-- Left sidebar: Settings -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-scroll">


                <!-- Instructions -->
                <details class="settings-group">
                    <summary>Instructions</summary>
                    <div class="settings-content">
                        <div class="instructions-box">
                            <p><strong>Quick Start</strong></p>
                            <ol>
                                <li>Enter your Azure AI Services <strong>Endpoint</strong> and <strong>Subscription Key</strong> (or Entra Token for agent modes).</li>
                                <li>Select a <strong>Model</strong> or configure an <strong>Agent</strong>.</li>
                                <li>Optionally enable <strong>Noise Suppression</strong> and <strong>Echo Cancellation</strong>.</li>
                                <li>Choose a <strong>Turn Detection</strong> mode.</li>
                                <li>Configure <strong>Voice</strong> and <strong>Avatar</strong> settings.</li>
                                <li>Click <strong>Connect</strong> to start.</li>
                            </ol>
                        </div>
                    </div>
                </details>

                <!-- Connection Settings -->
                <details class="settings-group" open>
                    <summary>Connection Settings</summary>
                    <div class="settings-content">
                        <label>Mode
                            <select id="mode">
                                <option value="model" selected>Model</option>
                                <option value="agent">Agent</option>
                                <option value="agent-v2">Agent V2</option>
                            </select>
                        </label>
                        <label>Azure AI Services Endpoint
                            <input type="text" id="endpoint" placeholder="Azure AI Services Endpoint" />
                        </label>
                        <div id="subscriptionKeyField">
                            <label>Subscription Key
                                <input type="password" id="apiKey" placeholder="Subscription Key" />
                            </label>
                        </div>
                        <div id="entraTokenField" style="display:none">
                            <label>Entra Token
                                <input type="password" id="entraToken" placeholder="Entra Token" />
                            </label>
                        </div>
                        <div id="agentFields" style="display:none">
                            <label>Agent Project Name
                                <input type="text" id="agentProjectName" placeholder="Project name" />
                            </label>
                            <div id="agentIdField">
                                <label>Agent ID
                                    <input type="text" id="agentId" placeholder="Agent ID" />
                                </label>
                            </div>
                            <div id="agentNameField" style="display:none">
                                <label>Agent Name
                                    <input type="text" id="agentName" placeholder="Agent name" />
                                </label>
                            </div>
                        </div>
                        <div id="modelField">
                            <label>Model
                                <select id="model">
                                    <option value="gpt-4o-realtime">GPT Realtime</option>
                                    <option value="gpt-4o-mini-realtime">GPT Realtime Mini</option>
                                    <option value="gpt-4.1">GPT-4.1 (Cascaded)</option>
                                    <option value="gpt-4.1-mini">GPT-4.1 Mini (Cascaded)</option>
                                    <option value="gpt-4.1-nano">GPT-4.1 Nano (Cascaded)</option>
                                    <option value="gpt-4o">GPT-4o (Cascaded)</option>
                                    <option value="gpt-4o-mini">GPT-4o Mini (Cascaded)</option>
                                    <option value="phi4-mm">Phi4-MM Realtime</option>
                                    <option value="phi4-mini">Phi4 Mini (Cascaded)</option>
                                </select>
                            </label>
                        </div>
                    </div>
                </details>

                <!-- Conversation Settings -->
                <details class="settings-group" open>
                    <summary>Conversation Settings</summary>
                    <div class="settings-content">
                        <!-- SR Model (cascaded only) -->
                        <div id="srModelField" style="display:none">
                            <label>Speech Recognition Model
                                <select id="srModel">
                                    <option value="azure-speech" selected>Azure Speech</option>
                                    <option value="mai-ears-1">MAI Ears 1</option>
                                </select>
                            </label>
                        </div>
                        <!-- Recognition Language (cascaded only, not mai-ears-1) -->
                        <div id="recognitionLanguageField" style="display:none">
                            <label>Recognition Language
                                <select id="recognitionLanguage">
                                    <option value="auto" selected>Auto Detect</option>
                                    <option value="en-US">English (United States)</option>
                                    <option value="zh-CN">Chinese (China)</option>
                                    <option value="de-DE">German (Germany)</option>
                                    <option value="en-GB">English (United Kingdom)</option>
                                    <option value="en-IN">English (India)</option>
                                    <option value="es-ES">Spanish (Spain)</option>
                                    <option value="es-MX">Spanish (Mexico)</option>
                                    <option value="fr-FR">French (France)</option>
                                    <option value="hi-IN">Hindi (India)</option>
                                    <option value="it-IT">Italian (Italy)</option>
                                    <option value="ja-JP">Japanese (Japan)</option>
                                    <option value="ko-KR">Korean (South Korea)</option>
                                    <option value="pt-BR">Portuguese (Brazil)</option>
                                </select>
                            </label>
                        </div>

                        <label class="toggle-label">
                            <span>Noise suppression</span>
                            <input type="checkbox" id="useNS" />
                        </label>
                        <label class="toggle-label">
                            <span>Echo cancellation</span>
                            <input type="checkbox" id="useEC" />
                        </label>

                        <label>Turn detection
                            <select id="turnDetectionType">
                                <option value="server_vad" selected>Server VAD</option>
                                <option value="azure_semantic_vad">Azure Semantic VAD</option>
                            </select>
                        </label>
                        <div id="fillerWordsField" style="display:none">
                            <label class="toggle-label">
                                <span>Remove filler words</span>
                                <input type="checkbox" id="removeFillerWords" />
                            </label>
                        </div>

                        <!-- EOU Detection (cascaded only) -->
                        <div id="eouDetectionField" style="display:none">
                            <label>EOU detection
                                <select id="eouDetectionType">
                                    <option value="none" selected>Disabled</option>
                                    <option value="semantic_detection_v1">Semantic Detection</option>
                                </select>
                            </label>
                        </div>

                        <!-- Instructions (model mode only) -->
                        <div id="instructionsField">
                            <label>Model instructions
                                <textarea id="instructions" rows="4"></textarea>
                            </label>
                        </div>

                        <label class="toggle-label">
                            <span>Enable proactive responses</span>
                            <input type="checkbox" id="enableProactive" />
                        </label>

                        <!-- Temperature -->
                        <div id="temperatureField">
                            <label>Temperature
                                <input type="range" id="temperature" min="0" max="1.2" step="0.1" value="0.9" />
                                <span id="tempValue">0.9</span>
                            </label>
                        </div>

                        <!-- Voice Configuration -->
                        <div class="config-section">
                            <div class="section-title">Voice Configuration</div>
                            <label>Voice Type
                                <select id="voiceType">
                                    <option value="standard" selected>Standard Voices</option>
                                    <option value="custom">Custom Voice</option>
                                    <option value="personal">Personal Voice</option>
                                </select>
                            </label>

                            <!-- Custom Voice -->
                            <div id="customVoiceFields" class="voice-variant custom-border" style="display:none">
                                <label>Voice Deployment ID
                                    <input type="text" id="voiceDeploymentId" placeholder="Voice Deployment ID" />
                                </label>
                                <label>Voice
                                    <input type="text" id="customVoiceName" placeholder="Voice" />
                                </label>
                            </div>

                            <!-- Personal Voice -->
                            <div id="personalVoiceFields" class="voice-variant personal-border" style="display:none">
                                <label>Personal Voice Name
                                    <input type="text" id="personalVoiceName" placeholder="Personal Voice Name" />
                                </label>
                                <label>Personal Voice Model
                                    <select id="personalVoiceModel">
                                        <option value="DragonLatestNeural">DragonLatestNeural</option>
                                        <option value="DragonHDOmniLatestNeural">DragonHDOmniLatestNeural</option>
                                    </select>
                                </label>
                            </div>

                            <!-- Standard Voice -->
                            <div id="standardVoiceField" class="voice-variant standard-border">
                                <label>Voice
                                    <select id="voiceName">
                                            <option value="en-us-ava:DragonHDLatestNeural">DragonHDLatestNeural, Ava (HD)</option>
                                            <option value="en-us-steffan:DragonHDLatestNeural">DragonHDLatestNeural, Steffan (HD)</option>
                                            <option value="en-us-andrew:DragonHDLatestNeural">DragonHDLatestNeural, Andrew (HD)</option>
                                            <option value="zh-cn-xiaochen:DragonHDLatestNeural">DragonHDLatestNeural, Xiaochen (HD)</option>
                                            <option value="en-us-emma:DragonHDLatestNeural">DragonHDLatestNeural, Emma (HD)</option>
                                            <option value="en-us-emma2:DragonHDLatestNeural">DragonHDLatestNeural, Emma (HD 2)</option>
                                            <option value="en-us-andrew2:DragonHDLatestNeural">DragonHDLatestNeural, Andrew (HD 2)</option>
                                            <option value="de-de-seraphina:DragonHDLatestNeural">DragonHDLatestNeural, Seraphina (HD)</option>
                                            <option value="en-us-aria:DragonHDLatestNeural">DragonHDLatestNeural, Aria (HD)</option>
                                            <option value="en-us-davis:DragonHDLatestNeural">DragonHDLatestNeural, Davis (HD)</option>
                                            <option value="en-us-jenny:DragonHDLatestNeural">DragonHDLatestNeural, Jenny (HD)</option>
                                            <option value="ja-jp-masaru:DragonHDLatestNeural">DragonHDLatestNeural, Masaru (HD)</option>
                                            <option value="en-US-AvaMultilingualNeural" selected>Ava Multilingual</option>
                                            <option value="en-US-AlloyTurboMultilingualNeural">Alloy Turbo Multilingual</option>
                                            <option value="en-US-AndrewMultilingualNeural">Andrew Multilingual</option>
                                            <option value="en-US-BrianMultilingualNeural">Brian Multilingual</option>
                                            <option value="en-US-EmmaMultilingualNeural">Emma Multilingual</option>
                                            <option value="en-US-NovaTurboMultilingualNeural">Nova Turbo Multilingual</option>
                                            <option value="zh-CN-XiaoxiaoMultilingualNeural">Xiaoxiao Multilingual</option>
                                            <option value="en-US-AvaNeural">Ava</option>
                                            <option value="en-US-AndrewNeural">Andrew</option>
                                            <option value="en-US-JennyNeural">Jenny</option>
                                            <option value="zh-HK-HiuMaanNeural">HiuMaan (Cantonese)</option>
                                            <option value="mt-MT-JosephNeural">Joseph (Maltese)</option>
                                            <option value="zh-CN-Xiaoxiao2:DragonHDFlashLatestNeural">Xiaoxiao2 HDFlash</option>
                                            <option value="zh-CN-Yunyi:DragonHDFlashLatestNeural">Yunyi HDFlash</option>
                                            <option value="alloy">Alloy (OpenAI)</option>
                                            <option value="ash">Ash (OpenAI)</option>
                                            <option value="ballad">Ballad (OpenAI)</option>
                                            <option value="coral">Coral (OpenAI)</option>
                                            <option value="echo">Echo (OpenAI)</option>
                                            <option value="sage">Sage (OpenAI)</option>
                                            <option value="shimmer">Shimmer (OpenAI)</option>
                                            <option value="verse">Verse (OpenAI)</option>
                                    </select>
                                </label>
                            </div>

                            <!-- Voice Temperature (DragonHD / personal) -->
                            <div id="voiceTempField" style="display:none">
                                <label>Voice Temperature
                                    <input type="range" id="voiceTemperature" min="0" max="1" step="0.1" value="0.9" />
                                    <span id="voiceTempValue">0.9</span>
                                </label>
                            </div>

                            <!-- Voice Speed -->
                            <div id="voiceSpeedField">
                                <label>Voice Speed
                                    <input type="range" id="voiceSpeed" min="50" max="150" step="5" value="100" />
                                    <span id="voiceSpeedValue">100%</span>
                                </label>
                            </div>
                        </div>

                        <!-- Avatar Settings -->
                        <div class="config-section">
                            <div class="section-title">Avatar</div>
                            <label class="toggle-label">
                                <span>Avatar</span>
                                <input type="checkbox" id="avatarEnabled" checked />
                            </label>
                            <div id="avatarSettings">
                                <label class="toggle-label">
                                    <span>Use Photo Avatar</span>
                                    <input type="checkbox" id="isPhotoAvatar" />
                                </label>

                                <div id="avatarOutputModeField">
                                    <label>Avatar Output Mode
                                        <select id="avatarOutputMode">
                                            <option value="webrtc" selected>WebRTC</option>
                                            <option value="websocket">WebSocket</option>
                                        </select>
                                    </label>
                                </div>

                                <label class="toggle-label">
                                    <span>Use Custom Avatar</span>
                                    <input type="checkbox" id="isCustomAvatar" />
                                </label>

                                <!-- Standard Avatar -->
                                <div id="standardAvatarField">
                                    <label>Avatar Character
                                        <select id="avatarName">
                                            <option value="Harry-business">Harry-business</option>
                                            <option value="Harry-casual">Harry-casual</option>
                                            <option value="Harry-youthful">Harry-youthful</option>
                                            <option value="Jeff-business">Jeff-business</option>
                                            <option value="Jeff-formal">Jeff-formal</option>
                                            <option value="Lisa-casual-sitting" selected>Lisa-casual-sitting</option>
                                            <option value="Lori-casual">Lori-casual</option>
                                            <option value="Lori-formal">Lori-formal</option>
                                            <option value="Lori-graceful">Lori-graceful</option>
                                            <option value="Max-business">Max-business</option>
                                            <option value="Max-casual">Max-casual</option>
                                            <option value="Max-formal">Max-formal</option>
                                            <option value="Meg-business">Meg-business</option>
                                            <option value="Meg-casual">Meg-casual</option>
                                            <option value="Meg-formal">Meg-formal</option>
                                        </select>
                                    </label>
                                </div>

                                <!-- Photo Avatar -->
                                <div id="photoAvatarField" style="display:none">
                                    <label>Photo Avatar Character
                                        <select id="photoAvatarName">
                                            <option value="Adrian">Adrian</option>
                                            <option value="Amara">Amara</option>
                                            <option value="Amira">Amira</option>
                                            <option value="Anika" selected>Anika</option>
                                            <option value="Bianca">Bianca</option>
                                            <option value="Camila">Camila</option>
                                            <option value="Carlos">Carlos</option>
                                            <option value="Clara">Clara</option>
                                            <option value="Darius">Darius</option>
                                            <option value="Diego">Diego</option>
                                            <option value="Elise">Elise</option>
                                            <option value="Farhan">Farhan</option>
                                            <option value="Faris">Faris</option>
                                            <option value="Gabrielle">Gabrielle</option>
                                            <option value="Hyejin">Hyejin</option>
                                            <option value="Imran">Imran</option>
                                            <option value="Isabella">Isabella</option>
                                            <option value="Layla">Layla</option>
                                            <option value="Ling">Ling</option>
                                            <option value="Liwei">Liwei</option>
                                            <option value="Marcus">Marcus</option>
                                            <option value="Matteo">Matteo</option>
                                            <option value="Rahul">Rahul</option>
                                            <option value="Rana">Rana</option>
                                            <option value="Ren">Ren</option>
                                            <option value="Riya">Riya</option>
                                            <option value="Sakura">Sakura</option>
                                            <option value="Simone">Simone</option>
                                            <option value="Zayd">Zayd</option>
                                            <option value="Zoe">Zoe</option>
                                        </select>
                                    </label>
                                </div>

                                <!-- Custom Avatar Name -->
                                <div id="customAvatarField" style="display:none">
                                    <label>Custom Avatar Name
                                        <input type="text" id="customAvatarName" placeholder="Character" />
                                    </label>
                                </div>

                                <label>Avatar Background Image URL
                                    <input type="text" id="avatarBackgroundImageUrl" placeholder="Enter avatar background image URL" />
                                </label>

                                <!-- Photo Avatar Scene Settings -->
                                <div id="photoAvatarSceneSettings" style="display:none">
                                    <div class="subsection-title" id="sceneSettingsTitle">Scene Settings</div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="sceneZoomLabel">Zoom: 100%</span>
                                        <input type="range" id="sceneZoom" min="70" max="100" step="1" value="100" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="scenePositionXLabel">Position X: 0%</span>
                                        <input type="range" id="scenePositionX" min="-50" max="50" step="1" value="0" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="scenePositionYLabel">Position Y: 0%</span>
                                        <input type="range" id="scenePositionY" min="-50" max="50" step="1" value="0" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="sceneRotationXLabel">Rotation X: 0 deg</span>
                                        <input type="range" id="sceneRotationX" min="-30" max="30" step="1" value="0" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="sceneRotationYLabel">Rotation Y: 0 deg</span>
                                        <input type="range" id="sceneRotationY" min="-30" max="30" step="1" value="0" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="sceneRotationZLabel">Rotation Z: 0 deg</span>
                                        <input type="range" id="sceneRotationZ" min="-30" max="30" step="1" value="0" />
                                    </div>
                                    <div class="scene-slider">
                                        <span class="scene-label" id="sceneAmplitudeLabel">Amplitude: 100%</span>
                                        <input type="range" id="sceneAmplitude" min="10" max="100" step="1" value="100" />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>
            </div>

            <!-- Connect / Disconnect Button -->
            <div class="sidebar-footer">
                <button id="connectBtn" class="btn btn-connect" onclick="toggleConnection()">
                    <svg id="connectIcon" class="btn-icon-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18"><path d="M18.36 6.64a9 9 0 1 1-12.73 0"/><line x1="12" y1="2" x2="12" y2="12"/></svg>
                    <span id="connectBtnText">Connect</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <div class="header-bar">
                <button class="btn btn-icon mobile-menu" onclick="toggleSidebar()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="20" height="20"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                </button>
                <div class="header-right">
                    <label class="toggle-label compact">
                        <span>Developer mode</span>
                        <input type="checkbox" id="developerMode" />
                    </label>
                    <button class="btn btn-text" onclick="clearChat()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="14" height="14"><path d="M3 6h18"/><path d="M8 6V4h8v2"/><path d="M5 6v14a2 2 0 002 2h10a2 2 0 002-2V6"/></svg>
                    </button>
                </div>
            </div>

            <!-- Content area -->
            <div class="content-area" id="contentArea">
                <!-- Avatar video (WebRTC) -->
                <div id="avatarVideoContainer" class="avatar-container" style="display:none">
                    <div id="avatarVideo" class="avatar-video"></div>
                </div>

                <!-- Volume animation (no avatar) -->
                <div id="volumeAnimation" class="volume-animation" style="display:none">
                    <div class="volume-circle" id="volumeCircle">
                        <svg class="robot-svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="8" width="18" height="12" rx="2" />
                            <circle cx="9" cy="14" r="1.5" />
                            <circle cx="15" cy="14" r="1.5" />
                            <path d="M12 2v4" />
                            <circle cx="12" cy="2" r="1" />
                        </svg>
                    </div>
                </div>

                <!-- Chat messages -->
                <div id="chatArea" class="chat-area">
                    <div id="messages" class="messages"></div>
                </div>
            </div>

            <!-- Input area (developer mode) -->
            <div id="inputArea" class="input-area" style="display:none">
                <div class="input-row">
                    <input type="text" id="textInput" placeholder="Type your message..."
                           onkeydown="if(event.key==='Enter')sendTextMessage()" />
                    <button id="micBtn" class="btn btn-icon mic-btn" onclick="toggleMicrophone()" title="Toggle microphone">
                        <!-- Off icon: mic with slash (default state) -->
                        <svg class="mic-off-icon" viewBox="0 0 20 20" width="20" height="20" fill="#242424">
                            <path d="M10 13a3 3 0 003-3V5a3 3 0 00-6 0v5a3 3 0 003 3z"/>
                            <path d="M15 10a5 5 0 01-10 0H3a7 7 0 006 6.92V20h2v-3.08A7 7 0 0017 10h-2z"/>
                            <line x1="3" y1="3" x2="17" y2="17" stroke="#242424" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                        <!-- Recording icon: red circle (active state) -->
                        <svg class="mic-on-icon" viewBox="0 0 20 20" width="20" height="20" style="display:none">
                            <circle cx="10" cy="10" r="6" fill="#A80000"/>
                        </svg>
                    </button>
                    <button class="btn btn-primary send-btn" onclick="sendTextMessage()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="16" height="16"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
                    </button>
                </div>
            </div>

            <!-- Footer (non-developer mode) -->
            <div id="footerArea" class="footer-area">
                <div class="record-container" id="recordContainer" style="display:none">
                    <div class="recording-border">
                        <div class="sound-wave" id="soundWaveLeft"></div>
                        <button id="recordBtn" class="record-btn" onclick="toggleMicrophone()" title="Turn on/off microphone">
                            <!-- Off icon: mic with slash -->
                            <svg class="mic-off-icon" viewBox="0 0 20 20" width="20" height="20" fill="#242424">
                                <path d="M10 13a3 3 0 003-3V5a3 3 0 00-6 0v5a3 3 0 003 3z"/>
                                <path d="M15 10a5 5 0 01-10 0H3a7 7 0 006 6.92V20h2v-3.08A7 7 0 0017 10h-2z"/>
                                <line x1="3" y1="3" x2="17" y2="17" stroke="#242424" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                            <!-- Recording icon: red circle -->
                            <svg class="mic-on-icon" viewBox="0 0 20 20" width="20" height="20" style="display:none">
                                <circle cx="10" cy="10" r="6" fill="#A80000"/>
                            </svg>
                            <span class="microphone-label">Turn on microphone</span>
                        </button>
                        <div class="sound-wave" id="soundWaveRight"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="app.js"></script>
</body>
</html>
